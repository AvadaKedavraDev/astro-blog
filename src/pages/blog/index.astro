---
// src/pages/blog/index.astro
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import Pagination from "@components/common/Pagination.astro";
import PageSiderBar from "@components/article/PageSiderBar.astro";
import PostCard from "@components/ui/PostCard.astro";

const allPosts = (await getCollection("blog")).sort(
    (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
        new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime(),
);

const POSTS_PER_PAGE = 10;
const currentPage = 1;
const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const posts = allPosts.slice(0, POSTS_PER_PAGE);
const hasPosts = posts.length > 0;
---

<BaseLayout title="博客文章" description="探索技术文章和教程">
    <aside class=" transition-all duration-300 ease-in-out overflow-hidden flex-shrink-0 m-8 w-64">
        <div class="p-6 w-64"><h2 class="text-xl font-bold">左侧菜单</h2>
            <ul class="mt-4 space-y-2">
                <li class="hover:bg-indigo-700 p-2 rounded cursor-pointer">项目列表</li>
                <li class="hover:bg-indigo-700 p-2 rounded cursor-pointer">团队协作</li>
            </ul>
        </div>
    </aside>
    <main class="flex-1 flex flex-col min-w-0  m-8">
        <header class="h-16 border-b flex items-center justify-between m-8">
            <button @click="leftOpen = !leftOpen" class="p-2 hover:bg-gray-100 rounded">
                <span class="font-bold">☰</span>
            </button>

            <h1 class="text-lg font-semibold">主界面 (Flex-1)</h1>

            <button onclick="rightOpen = !rightOpen" class="p-2 hover:bg-gray-100 rounded">
                <span class="font-bold">⚙️</span>
            </button>
        </header>

        <section class="space-y-6 flex flex-col">
            {posts.map((post) => <PostCard {post} />)}
        </section>

        {
            !hasPosts && (
                        <div class="text-center py-12">
                            <p class="text-xl text-gray-500 dark:text-gray-400 mb-4">
                                还没有发布任何文章
                            </p>
                            <p class="text-sm text-gray-400 dark:text-gray-500">
                                敬请期待...
                            </p>
                        </div>
            )
        }

        {
            hasPosts && (
                        <div>
                            <Pagination
                                    section="blog"
                                    currentPage={currentPage}
                                    totalPages={totalPages}
                                    basePath="/page"
                            />
                            <div class="text-center mt-8 text-sm text-gray-500 dark:text-gray-400">
                                第 {currentPage} 页，共 {totalPages} 页，显示{" "}
                                {posts.length} 篇文章（总计 {allPosts.length} 篇）
                            </div>
                        </div>
            )
        }
    </main>
    <aside class="transition-all duration-300 ease-in-out overflow-hidden flex-shrink-0 m-8 w-64">
        <div class="p-6 w-80">
            <h2 class="text-lg font-semibold border-b pb-2">详情面板</h2>
            <div class="mt-4 space-y-4">
                <p class="text-sm text-gray-600">这里可以放置属性配置、帮助文档或通知中心。</p>
            </div>
        </div>
    </aside>
</BaseLayout>


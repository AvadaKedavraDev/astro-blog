---
// 定义组件的 Props 接口
export interface Props {
    size?: "sm" | "md" | "lg";
    variant?: "icon" | "button";
}

const { size = "md", variant = "icon" } = Astro.props;

const sizeClasses = {
    sm: "w-6 h-6",
    md: "w-8 h-8",
    lg: "w-10 h-10",
};

const variantClasses = {
    icon: "p-1 rounded-md",
    button: "px-3 py-2 rounded-lg border",
};
---

<button
        id="themeToggle"
        class={`flex items-center justify-center bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition-all hover:scale-105 ${sizeClasses[size]} ${variantClasses[variant]}`}
        aria-label="切换主题"
>
    <svg class="sun" width="20" height="20" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="5" fill="currentColor"></circle>
        <path
                d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42m12.72-12.72l1.42-1.42"
                stroke="currentColor"
                stroke-width="2"
                fill="none"></path>
    </svg>

    <svg class="moon" width="20" height="20" viewBox="0 0 24 24">
        <path
                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                fill="currentColor"></path>
    </svg>

    {
        variant === "button" && (
                    <span class="ml-2 text-sm">
                <span class="light-text">浅色</span>
                <span class="dark-text">深色</span>
            </span>
        )
    }
</button>

<style>
    /* 基础显示逻辑 */
    .sun { display: block; fill: currentColor; }
    .moon { display: none; fill: currentColor; }
    .light-text { display: inline; }
    .dark-text { display: none; }

    /* 深色模式下的状态叠加 */
    :global(.dark) .sun { display: none; }
    :global(.dark) .moon { display: block; }
    :global(.dark) .light-text { display: none; }
    :global(.dark) .dark-text { display: inline; }
</style>

<script is:inline>
    /**
     * 主题切换 - 全局事件委托版
     * 核心逻辑：监听器挂在 document 上，不受 Swup 容器替换影响
     */
    (function() {
        // 1. 声明一个全局标记，防止脚本被 Swup 重新加载时重复绑定 document 监听器
        if (window.hasThemeToggleInitialized) return;

        // 2. 统一的处理逻辑
        const performToggle = () => {
            const isDark = document.documentElement.classList.toggle("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
        };

        // 3. 事件委托：直接监听 document
        document.addEventListener('click', (event) => {
            // 只要点击的是 id 为 themeToggle 的元素或其内部图标
            if (event.target.closest('#themeToggle')) {
                performToggle();
            }
        });

        // 4. 标记已初始化
        window.hasThemeToggleInitialized = true;

        // 可选：调试日志
        console.log("Theme Toggle: Global delegation ready.");
    })();
</script>
---
/**
 * @component SwupScrollConfig
 * @description Swup 滚动配置组件，配置锚点滚动 offset
 * @features 解决固定导航栏遮挡锚点的问题
 * @usage 在 BaseLayout 中引用
 */
---

<script is:inline data-swup-ignore-script>
  // @ts-nocheck - 这是一个纯 JavaScript 文件，禁用 TypeScript 检查
  (function() {
    // 导航栏高度 64px + 额外间距 32px = 96px
    const SCROLL_OFFSET = 96;
    
    function configureSwupScroll() {
      // 检查 Swup 是否已初始化
      if (!window.swup) {
        return false;
      }
      
      // 检查 plugins 是否存在
      if (!window.swup.plugins || !Array.isArray(window.swup.plugins)) {
        return false;
      }
      
      // 获取 Scroll Plugin 实例
      const scrollPlugin = window.swup.plugins.find(p => p && p.name === 'SwupScrollPlugin');
      if (!scrollPlugin) {
        return false;
      }
      
      // 配置 offset
      if (scrollPlugin.options) {
        scrollPlugin.options.offset = SCROLL_OFFSET;
      }
      
      return true;
    }
    
    // 尝试配置，如果失败则重试
    function tryConfigure() {
      if (!configureSwupScroll()) {
        setTimeout(tryConfigure, 100);
      }
    }
    
    // 页面加载完成后尝试配置
    if (document.readyState === 'complete') {
      tryConfigure();
    } else {
      window.addEventListener('load', tryConfigure);
    }
    
    // 使用 SwupCompat 在每次页面视图更新后重新配置
    if (window.SwupCompat) {
      window.SwupCompat.onPageView(tryConfigure);
    } else {
      // 降级处理
      document.addEventListener('swup:contentReplaced', tryConfigure);
      document.addEventListener('astro:page-load', tryConfigure);
    }
    
    // 同时监听 swup:enable 事件
    document.addEventListener('swup:enable', () => {
      // Swup 启用后，等待 hooks 可用
      setTimeout(tryConfigure, 100);
    });
  })();
</script>

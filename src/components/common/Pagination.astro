---
interface Props {
  section: string;
  currentPage: number;
  totalPages: number;
  basePath: string;
}

const { section, currentPage, totalPages, basePath } = Astro.props;

// 计算显示的页码范围
const getPageNumbers = () => {
  const pages: (number | string)[] = [];
  const showEllipsis = totalPages > 7;
  
  if (!showEllipsis) {
    for (let i = 1; i <= totalPages; i++) {
      pages.push(i);
    }
  } else {
    if (currentPage <= 3) {
      for (let i = 1; i <= 4; i++) pages.push(i);
      pages.push('...');
      pages.push(totalPages);
    } else if (currentPage >= totalPages - 2) {
      pages.push(1);
      pages.push('...');
      for (let i = totalPages - 3; i <= totalPages; i++) pages.push(i);
    } else {
      pages.push(1);
      pages.push('...');
      for (let i = currentPage - 1; i <= currentPage + 1; i++) pages.push(i);
      pages.push('...');
      pages.push(totalPages);
    }
  }
  
  return pages;
};

const pageNumbers = getPageNumbers();
---

<nav class="flex items-center justify-center gap-2" aria-label="分页">
  {/* Previous */}
  {currentPage > 1 ? (
    <a
      href={currentPage === 2 ? `/${section}/` : `/${section}${basePath}/${currentPage - 1}/`}
      class="p-2 rounded-lg pagination-btn"
      aria-label="上一页"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </a>
  ) : (
    <span class="p-2 rounded-lg text-muted-foreground/30 cursor-not-allowed">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </span>
  )}
  
  {/* Page Numbers */}
  <div class="flex items-center gap-1">
    {pageNumbers.map((page) => (
      page === '...' ? (
        <span class="px-3 py-2 text-muted-foreground">...</span>
      ) : (
        <a
          href={page === 1 ? `/${section}/` : `/${section}${basePath}/${page}/`}
          class={`min-w-[2.5rem] h-10 px-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center ${
            currentPage === page
              ? 'bg-foreground text-background'
              : 'pagination-btn'
          }`}
        >
          {page}
        </a>
      )
    ))}
  </div>
  
  {/* Next */}
  {currentPage < totalPages ? (
    <a
      href={`/${section}${basePath}/${currentPage + 1}/`}
      class="p-2 rounded-lg pagination-btn"
      aria-label="下一页"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </a>
  ) : (
    <span class="p-2 rounded-lg text-muted-foreground/30 cursor-not-allowed">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </span>
  )}
</nav>
